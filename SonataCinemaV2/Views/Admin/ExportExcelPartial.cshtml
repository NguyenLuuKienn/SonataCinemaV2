<div class="report-management">
    <h2>Thống kê doanh thu và hoạt động</h2>

    @using (Html.BeginForm("ExportExcel", "Admin", FormMethod.Get))
    {
        <div class="form-group mb-3">
            <label>Chọn loại thống kê:</label>
            <select name="loaiThongKe" class="form-control" id="loaiThongKe" required>
                <option value="">-- Chọn loại thống kê --</option>
                <option value="Phim">Theo Phim</option>
                <option value="PhongChieu">Theo Phòng Chiếu</option>
                <option value="ToanRap">Toàn Rạp</option>
                <option value="Blog">Thống kê Blog</option>
            </select>
        </div>

        <div class="form-group mb-3" id="phimSelect" style="display:none;">
            <label>Chọn Phim:</label>
            @Html.DropDownList("ID_Phim", (SelectList)ViewBag.DanhSachPhim, "-- Chọn phim --", new { @class = "form-control" })
        </div>

        <div class="form-group mb-3" id="phongSelect" style="display:none;">
            <label>Chọn Phòng:</label>
            @Html.DropDownList("ID_Phong", (SelectList)ViewBag.DanhSachPhong, "-- Chọn phòng --", new { @class = "form-control" })
        </div>

        <div class="form-group mb-3">
            <label>Chọn khoảng thời gian:</label>
            <select name="khoangThoiGian" class="form-control" id="khoangThoiGian">
                <option value="Ngay">Tùy chọn ngày</option>
                <option value="Tuan">Theo tuần</option>
                <option value="Thang">Theo tháng</option>
                <option value="Nam">Theo năm</option>
            </select>
        </div>

        <div id="dateInputs">
            <!-- Các trường nhập ngày sẽ được động thay đổi dựa trên khoảng thời gian -->
            <div class="date-range mb-3" id="customDateRange">
                <div class="form-group">
                    <label>Từ ngày:</label>
                    <input type="date" name="startDate" class="form-control">
                </div>
                <div class="form-group mt-2">
                    <label>Đến ngày:</label>
                    <input type="date" name="endDate" class="form-control">
                </div>
            </div>

            <div class="form-group mb-3" id="weekSelect" style="display:none;">
                <label>Chọn tuần:</label>
                <input type="week" name="weekInput" class="form-control">
            </div>

            <div class="form-group mb-3" id="monthSelect" style="display:none;">
                <label>Chọn tháng:</label>
                <input type="month" name="monthInput" class="form-control">
            </div>

            <div class="form-group mb-3" id="yearSelect" style="display:none;">
                <label>Chọn năm:</label>
                <select name="yearInput" class="form-control">
                    @for (int year = DateTime.Now.Year; year >= 2020; year--)
                    {
                        <option value="@year">@year</option>
                    }
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-success">
            <i class="fas fa-file-excel me-2"></i> Xuất Báo Cáo
        </button>
    }
</div>

<style>
    .form-group {
        margin-bottom: 15px;
    }

    .date-range {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
    }
</style>

<script>
    $(document).ready(function () {
        function toggleInputs() {
            var loaiThongKe = $("#loaiThongKe").val();
            var khoangThoiGian = $("#khoangThoiGian").val();

            // Ẩn/hiện select phim và phòng
            $("#phimSelect").toggle(loaiThongKe === "Phim");
            $("#phongSelect").toggle(loaiThongKe === "PhongChieu");

            // Ẩn tất cả các input thời gian
            $("#customDateRange, #weekSelect, #monthSelect, #yearSelect").hide();

            // Hiện input thời gian tương ứng
            switch (khoangThoiGian) {
                case "Ngay":
                    $("#customDateRange").show();
                    break;
                case "Tuan":
                    $("#weekSelect").show();
                    break;
                case "Thang":
                    $("#monthSelect").show();
                    break;
                case "Nam":
                    $("#yearSelect").show();
                    break;
            }
        }

        $("#loaiThongKe, #khoangThoiGian").change(toggleInputs);
        toggleInputs(); // Gọi lần đầu để thiết lập trạng thái ban đầu
    });
</script>